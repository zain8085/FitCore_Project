<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitCore - Sign Up</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#39FF14',
                        secondary: '#1A1A1A'
                    },
                    borderRadius: {
                        'none': '0px',
                        'sm': '4px',
                        DEFAULT: '8px',
                        'md': '12px',
                        'lg': '16px',
                        'xl': '20px',
                        '2xl': '24px',
                        '3xl': '32px',
                        'full': '9999px',
                        'button': '8px'
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="style1.css">
</head>

<body>
    <header class="fixed w-full z-50 bg-black bg-opacity-80 backdrop-blur-md">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="FitCore.html" class="text-primary font-['Pacifico'] text-3xl">FitCore</a>
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="FitCore.html" class="text-white hover:text-primary">Home</a>
                    <a href="FitCore.html#features" class="text-white hover:text-primary">Features</a>
                    <a href="FitCore.html#membership" class="text-white hover:text-primary">Membership</a>
                    <a href="FitCore.html#trainers" class="text-white hover:text-primary">Trainers</a>
                    <a href="FitCore.html#testimonials" class="text-white hover:text-primary">Testimonials</a>
                    <a href="FitCore.html#contact" class="text-white hover:text-primary">Contact</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="signup-container min-h-screen pt-24 pb-16">
        <div class="overlay min-h-screen pt-24 pb-16">
            <div class="container mx-auto px-6">
                <div class="max-w-5xl mx-auto">
                    <div class="text-center mb-10">
                        <h1 class="text-4xl md:text-5xl font-bold mb-4">Create Your <span
                                class="text-primary">Account</span></h1>
                        <p class="text-xl text-gray-300">Join the FitCore community and start your fitness journey today
                        </p>
                    </div>
                    <div class="bg-black bg-opacity-80 backdrop-blur-md rounded-lg p-8 shadow-lg">

                        <form id="signupForm" class="space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Full Name</label>
                                    <input type="text" id="fullName"
                                        class="w-full bg-gray-800 border-none text-white px-4 py-3 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm"
                                        required placeholder="John">
                                </div>
                                <div>
                                    <label for="phoneNumber" class="block text-sm font-medium text-gray-300 mb-2">Phone
                                        Number</label>
                                    <input type="tel" id="phoneNumber" name="phoneNumber"
                                        class="w-full bg-gray-800 border-none text-white px-4 py-3 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm"
                                        required placeholder="+91 1234567890" pattern="[6789][0-9]{9}" maxlength="10"
                                        title="Please enter a valid 10-digit Indian mobile number (starts with 6, 7, 8, or 9)">
                                    <p id="phoneNumberError" class="text-red-500 text-sm mt-1 hidden"></p>
                                </div>
                                <!-- zain added new field -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                                    <textarea id="address"
                                        class="w-full bg-gray-800 border-none text-white px-4 py-3 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm"
                                        placeholder="123 Main St, Anytown"></textarea>
                                </div>
                                <!-- ------------ -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                                    <input type="email" id="email"
                                        class="w-full bg-gray-800 border-none text-white px-4 py-3 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm"
                                        required placeholder="john@gmail.com">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Role</label>
                                    <div class="relative">
                                        <button type="button" id="roleDropdown"
                                            class="w-full bg-gray-800 text-white px-4 py-3 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm text-left flex justify-between items-center">
                                            <span id="selectedRole">MEMBER</span>
                                            <i class="ri-arrow-down-s-line"></i>
                                        </button>
                                        <div id="roleOptions"
                                            class="absolute w-full mt-1 bg-gray-800 rounded shadow-lg hidden z-10">
                                            <div class="p-2">
                                                <div class="cursor-pointer hover:bg-gray-700 p-2 rounded"
                                                    data-role="MEMBER">MEMBER</div>
                                                <div class="cursor-pointer hover:bg-gray-700 p-2 rounded"
                                                    data-role="ADMIN">ADMIN</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="adminCodeContainer" class="hidden relative">
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Admin Code</label>
                                    <input type="password" id="adminCode"
                                        class="w-full bg-gray-800 border-none text-white px-4 py-3 pr-12 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm">
                                    <button type="button" id="toggleAdminCode"
                                        class="absolute top-10 right-4 text-gray-400 hover:text-primary transition-colors">
                                        <i class="ri-eye-line"></i>
                                    </button>
                                </div>

                                <!-- Password Field with Toggle -->
<div class="relative mb-4">
    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
    <input type="password" id="password"
        class="w-full bg-gray-800 border-none text-white px-4 py-3 pr-12 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm"
        required minlength="8" placeholder="Enter at least 8 characters">
    <button type="button" id="togglePassword"
        class="absolute top-10 right-4 text-gray-400 hover:text-primary transition-colors">
        <i class="ri-eye-line"></i>
    </button>
</div>

<!-- Confirm Password Field with Toggle -->
<div class="relative mb-4">
    <label class="block text-sm font-medium text-gray-300 mb-2">Confirm Password</label>
    <input type="password" id="confirmPassword"
        class="w-full bg-gray-800 border-none text-white px-4 py-3 pr-12 rounded focus:ring-2 focus:ring-primary focus:outline-none text-sm"
        required minlength="8" placeholder="Re-enter your password">
    <button type="button" id="toggleConfirmPassword"
        class="absolute top-10 right-4 text-gray-400 hover:text-primary transition-colors">
        <i class="ri-eye-line"></i>
    </button>
</div>

<!-- Optional: Simple Password Match Warning -->
<p id="matchWarning" class="text-red-500 text-sm mt-1 hidden">Passwords do not match.</p>

                            </div>

                            <div class="flex items-start">
                                <label class="custom-checkbox">
                                    <input type="checkbox" required>
                                    <span class="checkmark mr-3"></span>
                                    <span class="text-sm text-gray-300">I agree to the <a href="#"
                                            class="text-primary hover:underline">Terms of Service</a> and <a href="#"
                                            class="text-primary hover:underline">Privacy Policy</a>.</span>
                                </label>
                            </div>
                            <div>
                                <button type="submit"
                                    class="w-full bg-primary text-black py-4 !rounded-button font-bold text-lg hover:bg-opacity-80 transition-colors whitespace-nowrap">Create
                                    Account</button>
                                <p class="text-center mt-4 text-gray-400">Already have an account? <a
                                        href="sign_in.html" class="text-primary hover:underline">Log in</a></p>
                            </div>

                           

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Assume you have `roleDropdown`, `roleOptions`, `selectedRole`, `adminCodeContainer`
            // and password toggle elements already set up in your HTML and handled by JS here.

            const roleDropdown = document.getElementById('roleDropdown');
            const roleOptions = document.getElementById('roleOptions');
            const selectedRoleSpan = document.getElementById('selectedRole'); // Renamed to avoid conflict
            const adminCodeContainer = document.getElementById('adminCodeContainer');
            const adminCodeInput = document.getElementById('adminCode');
            const toggleAdminCodeBtn = document.getElementById('toggleAdminCode');

            // Password toggles (ensure your HTML has these IDs)
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const togglePasswordBtn = document.getElementById('togglePassword');
            const toggleConfirmPasswordBtn = document.getElementById('toggleConfirmPassword');

            // Handle role dropdown visibility
            if (roleDropdown) {
                roleDropdown.addEventListener('click', () => {
                    roleOptions.classList.toggle('hidden');
                });
            }

            // Handle role selection
            if (roleOptions) {
                roleOptions.querySelectorAll('[data-role]').forEach(option => {
                    option.addEventListener('click', () => {
                        const role = option.getAttribute('data-role');
                        selectedRoleSpan.textContent = role; // Use the renamed span
                        roleOptions.classList.add('hidden');

                        if (role === 'ADMIN') {
                            adminCodeContainer.classList.remove('hidden');
                            adminCodeInput.setAttribute('required', 'true');
                        } else {
                            adminCodeContainer.classList.add('hidden');
                            adminCodeInput.removeAttribute('required');
                        }
                    });
                });
            }

            // Close dropdown if clicking outside
            document.addEventListener('click', (event) => {
                if (roleDropdown && roleOptions && !roleDropdown.contains(event.target) && !roleOptions.contains(event.target)) {
                    roleOptions.classList.add('hidden');
                }
            });

            // Toggle password visibility for main password
            if (togglePasswordBtn && passwordInput) {
                togglePasswordBtn.addEventListener('click', () => {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    togglePasswordBtn.innerHTML = type === 'password' ? '<i class="ri-eye-line"></i>' : '<i class="ri-eye-off-line"></i>';
                });
            }

            // Toggle password visibility for confirm password
            if (toggleConfirmPasswordBtn && confirmPasswordInput) {
                toggleConfirmPasswordBtn.addEventListener('click', () => {
                    const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    confirmPasswordInput.setAttribute('type', type);
                    toggleConfirmPasswordBtn.innerHTML = type === 'password' ? '<i class="ri-eye-line"></i>' : '<i class="ri-eye-off-line"></i>';
                });
            }

            // Toggle admin code visibility
            if (toggleAdminCodeBtn && adminCodeInput) {
                toggleAdminCodeBtn.addEventListener('click', () => {
                    const type = adminCodeInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    adminCodeInput.setAttribute('type', type);
                    toggleAdminCodeBtn.innerHTML = type === 'password' ? '<i class="ri-eye-line"></i>' : '<i class="ri-eye-off-line"></i>';
                });
            }

            // Main signup form submission
            const signupForm = document.getElementById('signupForm');
            if (signupForm) {
                signupForm.addEventListener('submit', async (e) => {
                    e.preventDefault();

                    // Collect form values
                    const fullName = document.getElementById('fullName').value.trim();
                    const phone = document.getElementById('phoneNumber').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value.trim();
                    const confirmPassword = document.getElementById('confirmPassword').value.trim();
                    const role = selectedRoleSpan.textContent; // Get selected role from span
                    const adminCode = adminCodeInput.value.trim(); // Get admin code
                    const address = document.getElementById('address') ? document.getElementById('address').value.trim() : '';

                    // Simple front-end validations
                    if (password !== confirmPassword) {
                        showNotification('Passwords do not match.', 'error');
                        return;
                    }

                    // Admin code check is primarily done on backend, but this client-side check is fine too
                    if (role === 'ADMIN' && adminCode !== 'FITCORE2025') {
                        showNotification('Invalid Admin Code.', 'error');
                        return;
                    }

                    const signupData = {
                        fullName,
                        phone,
                        email,
                        password,
                        role,
                        adminCode,
                        address
                    };

                    try {
                        const response = await fetch('http://localhost:5000/api/auth/signup', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(signupData)
                        });

                        const result = await response.json();
                        if (response.ok) {
                            // ⭐ CRITICAL CHANGE HERE: Destructure the nested 'user' object ⭐28/6/25 ****************
                            const { token, message, user } = result; // Assuming 'user' object is sent

                            localStorage.setItem('token', token);
                            localStorage.setItem('role', user.role);        // From nested user object
                            localStorage.setItem('userId', user.userId);    // From nested user object
                            localStorage.setItem('memberId', user.memberId);// From nested user object
                            localStorage.setItem('userFullName', user.fullName); // From nested user object
                            localStorage.setItem('email', user.email);      // From nested user object
                            // *****************************************************************************************
                            showNotification(result.message, 'success');

                            // Store token and user role in localStorage after successful signup
                            // Store token and user role in localStorage after successful signup
                            if (result.token && result.user) { // Ensure result.user exists 28/6/25
                                localStorage.setItem('token', result.token);
                                localStorage.setItem('userRole', result.user.role);
                                // ⭐ NEW: Store user details for later use ⭐
                                localStorage.setItem('userId', result.user.userId);
                                localStorage.setItem('memberId', result.user.memberId);
                                localStorage.setItem('userFullName', result.user.fullName);
                                localStorage.setItem('userEmail', result.user.email);
                            }

                            setTimeout(() => {
                                if (role === 'ADMIN') {
                                    window.location.href = 'Admin-and-Member-Management.html';
                                } else {
                                    window.location.href = 'select-package.html'; // Redirect members to package selection
                                }
                            }, 2000); // Redirect after 2 seconds
                        } else {
                            showNotification(result.message || 'Signup failed.', 'error');
                        }

                    } catch (error) {
                        console.error('Error:', error);
                        showNotification('Server Error: Please try again later.', 'error');
                    }
                });
            }
        });

        // Helper function for notifications (make sure this is globally available or defined within DOMContentLoaded)
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded shadow-lg z-50 ${type === 'error' ? 'bg-red-500' : 'bg-green-500'} text-white`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }


        
    // Toggle password visibility
    document.getElementById("togglePassword").addEventListener("click", function () {
        const password = document.getElementById("password");
        password.type = password.type === "password" ? "text" : "password";
        this.querySelector("i").classList.toggle("ri-eye-line");
        this.querySelector("i").classList.toggle("ri-eye-off-line");
    });

    document.getElementById("toggleConfirmPassword").addEventListener("click", function () {
        const confirmPassword = document.getElementById("confirmPassword");
        confirmPassword.type = confirmPassword.type === "password" ? "text" : "password";
        this.querySelector("i").classList.toggle("ri-eye-line");
        this.querySelector("i").classList.toggle("ri-eye-off-line");
    });

    // Optional: Show password mismatch warning
    const passwordInput = document.getElementById("password");
    const confirmInput = document.getElementById("confirmPassword");
    const warning = document.getElementById("matchWarning");

    confirmInput.addEventListener("input", function () {
        if (confirmInput.value !== passwordInput.value) {
            warning.classList.remove("hidden");
        } else {
            warning.classList.add("hidden");
        }
    });


    </script>

</body>

</html>